<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Review Helper - 文献查找工作流</title>
    <link rel="stylesheet" href="common.css">
    <link rel="stylesheet" href="css/pages/literature-search-workflow.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Review Helper - 文献查找智能助手</h1>
            <p>智能搜索和筛选文献</p>
        </header>

        <div class="project-header">
            <div class="project-info">
                <span class="project-name" id="current-project-name">未选择项目</span>
                <span class="project-name" id="current-subproject-name" class="subproject-name"></span>
                <span class="project-status status-active" id="project-status">就绪</span>
            </div>
            <div class="button-group">
                <button class="btn btn-secondary" id="back-to-index-btn">返回</button>
            </div>
        </div>

        <!-- 主内容区域：左右分栏 -->
        <div class="main-content">
            <!-- 左侧：配置区域 -->
            <div class="main-left">
                <!-- 需求设置区域 -->
                <div class="requirement-section" id="requirement-section">
                    <h2>文献查找配置</h2>
                    <p class="form-description">请填写以下信息，系统将根据您的需求搜索和筛选文献</p>
                    
                    <div class="form-group">
                        <label class="form-label">API供应商</label>
                        <select id="main-api-provider-select" class="api-provider-select" 
>
                            <option value="deepseek">DeepSeek</option>
                            <option value="gemini">Google Gemini</option>
                            <option value="siliconflow">硅基流动</option>
                            <option value="poe">Poe</option>
                        </select>
                    </div>
                    
                    <!-- Gemini 模型选择（仅在选择 Gemini 时显示） -->
                    <div class="form-group" id="gemini-model-select-group" class="d-none">
                        <label class="form-label">Gemini 模型:</label>
                        <select id="gemini-model-select" class="api-provider-select" 
>
                            <option value="gemini-2.5-flash">Gemini 2.5 Flash（快速响应）</option>
                            <option value="gemini-2.5-pro">Gemini 2.5 Pro（更强大）</option>
                        </select>
                        <small class="form-hint">
                            <span id="gemini-model-desc">快速响应，适合大多数任务</span>
                        </small>
                    </div>

                    <!-- 硅基流动模型选择（仅在选择硅基流动时显示） -->
                    <div class="form-group" id="siliconflow-model-select-group" class="d-none">
                        <label class="form-label">硅基流动模型:</label>
                        <select id="siliconflow-model-select" class="api-provider-select" 
                                class="select-scrollable w-full"
>
                            <option value="deepseek-ai/DeepSeek-V3.2-Exp">deepseek-ai/DeepSeek-V3.2-Exp</option>
                            <option value="Pro/deepseek-ai/DeepSeek-V3.2-Exp">Pro/deepseek-ai/DeepSeek-V3.2-Exp</option>
                            <option value="inclusionAI/Ling-1T">inclusionAI/Ling-1T</option>
                            <option value="zai-org/GLM-4.6">zai-org/GLM-4.6</option>
                            <option value="moonshotai/Kimi-K2-Instruct-0905">moonshotai/Kimi-K2-Instruct-0905</option>
                            <option value="Pro/deepseek-ai/DeepSeek-V3.1-Terminus">Pro/deepseek-ai/DeepSeek-V3.1-Terminus</option>
                            <option value="deepseek-ai/DeepSeek-V3.1-Terminus">deepseek-ai/DeepSeek-V3.1-Terminus</option>
                            <option value="Qwen/Qwen3-Next-80B-A3B-Instruct">Qwen/Qwen3-Next-80B-A3B-Instruct</option>
                            <option value="Qwen/Qwen3-Next-80B-A3B-Thinking">Qwen/Qwen3-Next-80B-A3B-Thinking</option>
                            <option value="inclusionAI/Ring-flash-2.0">inclusionAI/Ring-flash-2.0</option>
                            <option value="inclusionAI/Ling-flash-2.0">inclusionAI/Ling-flash-2.0</option>
                            <option value="inclusionAI/Ling-mini-2.0">inclusionAI/Ling-mini-2.0</option>
                            <option value="ByteDance-Seed/Seed-OSS-36B-Instruct">ByteDance-Seed/Seed-OSS-36B-Instruct</option>
                            <option value="stepfun-ai/step3">stepfun-ai/step3</option>
                            <option value="Qwen/Qwen3-Coder-30B-A3B-Instruct">Qwen/Qwen3-Coder-30B-A3B-Instruct</option>
                            <option value="Qwen/Qwen3-Coder-480B-A35B-Instruct">Qwen/Qwen3-Coder-480B-A35B-Instruct</option>
                            <option value="Qwen/Qwen3-30B-A3B-Thinking-2507">Qwen/Qwen3-30B-A3B-Thinking-2507</option>
                            <option value="Qwen/Qwen3-30B-A3B-Instruct-2507">Qwen/Qwen3-30B-A3B-Instruct-2507</option>
                            <option value="Qwen/Qwen3-235B-A22B-Thinking-2507">Qwen/Qwen3-235B-A22B-Thinking-2507</option>
                            <option value="Qwen/Qwen3-235B-A22B-Instruct-2507">Qwen/Qwen3-235B-A22B-Instruct-2507</option>
                            <option value="zai-org/GLM-4.5-Air">zai-org/GLM-4.5-Air</option>
                            <option value="zai-org/GLM-4.5">zai-org/GLM-4.5</option>
                            <option value="baidu/ERNIE-4.5-300B-A47B">baidu/ERNIE-4.5-300B-A47B</option>
                            <option value="ascend-tribe/pangu-pro-moe">ascend-tribe/pangu-pro-moe</option>
                            <option value="tencent/Hunyuan-A13B-Instruct">tencent/Hunyuan-A13B-Instruct</option>
                            <option value="MiniMaxAI/MiniMax-M1-80k">MiniMaxAI/MiniMax-M1-80k</option>
                            <option value="Tongyi-Zhiwen/QwenLong-L1-32B">Tongyi-Zhiwen/QwenLong-L1-32B</option>
                            <option value="Qwen/Qwen3-30B-A3B">Qwen/Qwen3-30B-A3B</option>
                            <option value="Qwen/Qwen3-32B">Qwen/Qwen3-32B</option>
                            <option value="Qwen/Qwen3-14B">Qwen/Qwen3-14B</option>
                            <option value="Qwen/Qwen3-8B">Qwen/Qwen3-8B</option>
                            <option value="Qwen/Qwen3-235B-A22B">Qwen/Qwen3-235B-A22B</option>
                            <option value="THUDM/GLM-Z1-32B-0414">THUDM/GLM-Z1-32B-0414</option>
                            <option value="THUDM/GLM-4-32B-0414">THUDM/GLM-4-32B-0414</option>
                            <option value="THUDM/GLM-Z1-Rumination-32B-0414">THUDM/GLM-Z1-Rumination-32B-0414</option>
                            <option value="THUDM/GLM-4-9B-0414">THUDM/GLM-4-9B-0414</option>
                            <option value="Qwen/QwQ-32B" selected>Qwen/QwQ-32B（默认）</option>
                            <option value="Pro/deepseek-ai/DeepSeek-R1">Pro/deepseek-ai/DeepSeek-R1</option>
                            <option value="Pro/deepseek-ai/DeepSeek-V3">Pro/deepseek-ai/DeepSeek-V3</option>
                            <option value="deepseek-ai/DeepSeek-R1">deepseek-ai/DeepSeek-R1</option>
                            <option value="deepseek-ai/DeepSeek-V3">deepseek-ai/DeepSeek-V3</option>
                            <option value="deepseek-ai/DeepSeek-R1-0528-Qwen3-8B">deepseek-ai/DeepSeek-R1-0528-Qwen3-8B</option>
                            <option value="deepseek-ai/DeepSeek-R1-Distill-Qwen-32B">deepseek-ai/DeepSeek-R1-Distill-Qwen-32B</option>
                            <option value="deepseek-ai/DeepSeek-R1-Distill-Qwen-14B">deepseek-ai/DeepSeek-R1-Distill-Qwen-14B</option>
                            <option value="deepseek-ai/DeepSeek-R1-Distill-Qwen-7B">deepseek-ai/DeepSeek-R1-Distill-Qwen-7B</option>
                            <option value="Pro/deepseek-ai/DeepSeek-R1-Distill-Qwen-7B">Pro/deepseek-ai/DeepSeek-R1-Distill-Qwen-7B</option>
                            <option value="deepseek-ai/DeepSeek-V2.5">deepseek-ai/DeepSeek-V2.5</option>
                            <option value="Qwen/Qwen2.5-72B-Instruct-128K">Qwen/Qwen2.5-72B-Instruct-128K</option>
                            <option value="Qwen/Qwen2.5-72B-Instruct">Qwen/Qwen2.5-72B-Instruct</option>
                            <option value="Qwen/Qwen2.5-32B-Instruct">Qwen/Qwen2.5-32B-Instruct</option>
                            <option value="Qwen/Qwen2.5-14B-Instruct">Qwen/Qwen2.5-14B-Instruct</option>
                            <option value="Qwen/Qwen2.5-7B-Instruct">Qwen/Qwen2.5-7B-Instruct</option>
                            <option value="Qwen/Qwen2.5-Coder-32B-Instruct">Qwen/Qwen2.5-Coder-32B-Instruct</option>
                            <option value="Qwen/Qwen2.5-Coder-7B-Instruct">Qwen/Qwen2.5-Coder-7B-Instruct</option>
                            <option value="Qwen/Qwen2-7B-Instruct">Qwen/Qwen2-7B-Instruct</option>
                            <option value="THUDM/glm-4-9b-chat">THUDM/glm-4-9b-chat</option>
                            <option value="internlm/internlm2_5-7b-chat">internlm/internlm2_5-7b-chat</option>
                            <option value="Pro/Qwen/Qwen2.5-7B-Instruct">Pro/Qwen/Qwen2.5-7B-Instruct</option>
                            <option value="Pro/Qwen/Qwen2-7B-Instruct">Pro/Qwen/Qwen2-7B-Instruct</option>
                            <option value="Pro/THUDM/glm-4-9b-chat">Pro/THUDM/glm-4-9b-chat</option>
                        </select>
                        <small class="form-hint">
                            请从列表中选择要使用的模型
                        </small>
                    </div>

                    <!-- Poe 模型选择（仅在选择 Poe 时显示） -->
                    <div class="form-group" id="poe-model-select-group" class="d-none">
                        <label class="form-label">Poe 模型:</label>
                        <select id="poe-model-select" class="api-provider-select" 
                                class="select-scrollable w-full"
>
                            <option value="Claude-Sonnet-4" selected>Claude-Sonnet-4（默认）</option>
                            <option value="Claude-3.5-Sonnet">Claude-3.5-Sonnet</option>
                            <option value="Claude-3-Opus">Claude-3-Opus</option>
                            <option value="Claude-3-Sonnet">Claude-3-Sonnet</option>
                            <option value="Claude-3-Haiku">Claude-3-Haiku</option>
                            <option value="GPT-4">GPT-4</option>
                            <option value="GPT-4-Turbo">GPT-4-Turbo</option>
                            <option value="GPT-4o">GPT-4o</option>
                            <option value="GPT-4o-mini">GPT-4o-mini</option>
                            <option value="GPT-3.5-Turbo">GPT-3.5-Turbo</option>
                            <option value="Llama-3.1-405B-Instruct">Llama-3.1-405B-Instruct</option>
                            <option value="Llama-3.1-70B-Instruct">Llama-3.1-70B-Instruct</option>
                            <option value="Llama-3-70B-Instruct">Llama-3-70B-Instruct</option>
                            <option value="Llama-3-8B-Instruct">Llama-3-8B-Instruct</option>
                            <option value="Mixtral-8x7B-Instruct">Mixtral-8x7B-Instruct</option>
                            <option value="PaLM-2">PaLM-2</option>
                            <option value="Sage">Sage</option>
                            <option value="Dragonfly">Dragonfly</option>
                        </select>
                        <small class="form-hint">
                            请从列表中选择要使用的模型
                        </small>
                    </div>
                    
                    <!-- ========== 整体配置 ========== -->
                    <div style="margin-bottom: 30px; padding-bottom: 20px; border-bottom: 2px solid #e5e7eb;">
                        <h3 style="margin: 0 0 20px 0; font-size: 18px; font-weight: 600; color: #1f2937;">整体配置</h3>
                        
                        <!-- 1. 查询的文献综述需求 -->
                        <div class="form-group" id="requirement-input-group">
                            <label class="form-label">查询的文献综述需求</label>
                            <textarea id="main-requirement-input" rows="5" placeholder="请详细描述您的文献查找需求，包括研究主题、研究范围、关注的重点等。例如：&#10;我需要查找关于'共享自动驾驶汽车以及mass系统'的文献，重点关注技术实现、系统架构、安全性和用户体验等方面。"></textarea>
                            <small class="form-hint">
                                此需求将用于AI提取搜索关键词和筛选文献</small>
                        </div>
                        
                        <!-- 2. 文献语言 -->
                        <div class="form-group" id="language-select-group">
                            <label class="form-label">文献语言:</label>
                            <select id="main-language-select" class="api-provider-select">
                                <option value="zh">中文</option>
                                <option value="en">English</option>
                            </select>
                            <small class="form-hint">
                                选择文献搜索和AI处理的语言，将影响关键词提取和文献筛选</small>
                        </div>
                        
                        <!-- 已移除：进行文献补全（选项）——补全固定为步骤4手动编辑精选文献 -->
                    </div>
                    
                    <!-- ========== 关键词配置 ========== -->
                    <div style="margin-bottom: 30px; padding-bottom: 20px; border-bottom: 2px solid #e5e7eb;">
                        <h3 style="margin: 0 0 20px 0; font-size: 18px; font-weight: 600; color: #1f2937;">关键词配置</h3>
                        
                        <!-- 关键词数量 -->
                        <div class="form-group" id="keyword-count-group">
                            <label class="form-label">关键词数量</label>
                            <input type="number" id="initial-keyword-count" value="10" min="1" max="20" class="w-full" placeholder="10">
                            <small class="form-hint">
                                关键词分析将生成对应数量的关键词用于文献搜索</small>
                        </div>
                    </div>
                    
                    <!-- ========== 搜索配置 ========== -->
                    <div style="margin-bottom: 30px; padding-bottom: 20px; border-bottom: 2px solid #e5e7eb;">
                        <h3 style="margin: 0 0 20px 0; font-size: 18px; font-weight: 600; color: #1f2937;">搜索配置</h3>
                        
                        <!-- 1. 文献来源库 -->
                        <div class="form-group" id="literature-source-group">
                            <label class="form-label">文献来源库</label>
                            <select id="literature-source-select" class="api-provider-select">
                                <option value="google-scholar">Google Scholar（谷歌学术）</option>
                                <option value="lanfanshu">烂番薯学术（Google Scholar镜像站）</option>
                            </select>
                            <small class="form-hint">
                                选择文献搜索的来源数据库（后续将支持更多数据库）
                            </small>
                        </div>
                        
                        <!-- 2. 每个关键词文献数 -->
                        <div class="form-group" id="per-keyword-limit-group">
                            <label class="form-label">每个关键词文献数</label>
                            <input type="number" id="per-keyword-limit" value="20" min="1" class="w-full" placeholder="20">
                            <small class="form-hint">
                                每个关键词会翻页抓取，每页10个，直到达到指定数量
                            </small>
                        </div>
                        
                        <!-- 3. 年份限制 -->
                        <div class="form-group" id="year-limit-group">
                            <label class="form-label">年份限制:</label>
                            <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                                <div style="flex: 1; min-width: 200px;">
                                    <label style="display: block; margin-bottom: 5px; font-size: 13px; color: #666;">近N年</label>
                                    <input type="number" id="recent-years-input" value="5" min="1" max="20" placeholder="5" class="w-full">
                                </div>
                                <div style="flex: 1; min-width: 200px;">
                                    <label style="display: block; margin-bottom: 5px; font-size: 13px; color: #666;">占比（%）</label>
                                    <input type="number" id="recent-years-percentage" value="60" min="0" max="100" placeholder="60" class="w-full">
                                </div>
                            </div>
                            <small class="form-hint">
                                例如：近5年占60%，表示搜索结果中60%的文献应该是最近5年发表的
                            </small>
                        </div>
                    </div>
                    
                    <!-- ========== 精选配置 ========== -->
                    <div style="margin-bottom: 30px; padding-bottom: 20px;">
                        <h3 style="margin: 0 0 20px 0; font-size: 18px; font-weight: 600; color: #1f2937;">精选配置</h3>
                        
                        <!-- 1. 精选文献数量 -->
                        <div class="form-group" id="target-count-group">
                            <label class="form-label">精选文献数量:</label>
                            <input type="number" id="main-target-count" value="50" min="10" max="500" placeholder="需要精选的文献数量" 
                                   style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 14px; transition: border-color 0.2s;">
                            <small class="form-hint">提示：从初筛的论文中一次性精选出此数量的高质量文献</small>
                        </div>
                    </div>
                    
                    <!-- 保存配置按钮 -->
                    <div style="margin-top: 20px; display: flex; gap: 10px;">
                        <button class="btn btn-primary" id="save-config-btn">保存配置</button>
                    </div>
                </div>
            </div>

            <!-- 右侧：流程节点区域 -->
            <div class="main-right">
                <div class="workflow-section">
                    <div class="workflow-title">
                        <h2>文献查找工作流程</h2>
                        <p>点击节点查看详情，完成所有步骤即可完成文献查找和筛选</p>
                    </div>

                    <!-- 节点流程可视化 -->
                    <div class="workflow-nodes">
                        <div class="workflow-line">
                            <div class="workflow-line-progress" id="workflow-progress"></div>
                        </div>

                        <!-- 节点1: 关键词分析 -->
                        <div class="node" data-node="1" data-status="pending" id="node-1">
                            <div class="node-icon-wrapper">
                                <div class="node-icon">
                                    <span class="node-step-label">步骤</span>
                                    <span class="node-step-number">1</span>
                                </div>
                            </div>
                            <div class="node-content-wrapper">
                                <div class="node-header">
                                    <div class="node-title">关键词分析</div>
                                    <div class="node-desc">AI提取搜索关键词</div>
                                </div>
                                <div class="node-footer">
                                    <div class="node-status-badge">待开始</div>
                                    <button class="node-execute-btn" data-node="1" id="execute-node-1-btn" type="button">
                                        <span class="btn-icon">▶</span>
                                        <span class="btn-text">执行</span>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- 节点2: 文献搜索 -->
                        <div class="node" data-node="2" data-status="pending" id="node-2">
                            <div class="node-icon-wrapper">
                                <div class="node-icon">
                                    <span class="node-step-label">步骤</span>
                                    <span class="node-step-number">2</span>
                                </div>
                            </div>
                            <div class="node-content-wrapper">
                                <div class="node-header">
                                    <div class="node-title">文献搜索</div>
                                    <div class="node-desc">Google Scholar搜索</div>
                                </div>
                                <div class="node-footer">
                                    <div class="node-status-badge">待开始</div>
                                    <button class="node-execute-btn" data-node="2" id="execute-node-2-btn" type="button" disabled>
                                        <span class="btn-icon">▶</span>
                                        <span class="btn-text">执行</span>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- 节点3: 精选文献 -->
                        <div class="node" data-node="3" data-status="pending" id="node-3">
                            <div class="node-icon-wrapper">
                                <div class="node-icon">
                                    <span class="node-step-label">步骤</span>
                                    <span class="node-step-number">3</span>
                                </div>
                            </div>
                            <div class="node-content-wrapper">
                                <div class="node-header">
                                    <div class="node-title">精选文献</div>
                                    <div class="node-desc">AI筛选与手动选择</div>
                                </div>
                                <div class="node-footer">
                                    <div class="node-status-badge">待开始</div>
                                    <button class="node-execute-btn" data-node="3" id="execute-node-3-btn" type="button" disabled>
                                        <span class="btn-icon">▶</span>
                                        <span class="btn-text">执行</span>
                                    </button>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <!-- 节点详情模态框 -->
        <div class="modal hidden" id="node-detail-modal" style="display: none !important; visibility: hidden;">
            <div class="modal-content modal-lg">
                <div class="modal-header">
                    <h3 id="node-detail-modal-title">节点详情</h3>
                    <button class="modal-close" id="close-node-detail-modal" type="button" aria-label="关闭">&times;</button>
                </div>
                <div class="modal-body" id="node-detail-modal-body">
                    <!-- 节点详情内容将动态插入这里 -->
                </div>
            </div>
        </div>

        <!-- 文献详情编辑模态框 -->
        <div class="modal hidden" id="literature-detail-modal" style="display: none !important; visibility: hidden;">
            <div class="modal-content modal-lg">
                <div class="modal-header">
                    <h3 id="literature-detail-modal-title">编辑文献</h3>
                    <button class="modal-close" id="close-literature-detail-modal" type="button" aria-label="关闭">&times;</button>
                </div>
                <div class="modal-body" id="literature-detail-modal-body">
                    <!-- 文献详情编辑内容将动态插入这里 -->
                </div>
            </div>
        </div>

        <!-- 保留原有的节点内容区域（隐藏，用于加载数据） -->
        <div class="main-right d-none" id="node-content-panel">
            <div class="main-right empty" id="node-content-empty">
                点击节点查看详情，或点击"总览"查看所有节点信息</div>
                
                <!-- 总览视图 -->
                <div id="overview-container" class="d-none">
                    <div class="overview-header">
                        <h2>项目总览</h2>
                        <p>查看所有节点的完成情况和关键信息（只读模式）</p>
                    </div>
                    
                    <!-- 节点1总览 -->
                    <div class="overview-node-card" data-node="1">
                        <div class="overview-node-header">
                            <h3>节点1：关键词分析</h3>
                            <span class="overview-node-status" id="overview-status-1">未开始</span>
                        </div>
                        <div class="overview-node-content" id="overview-content-1">
                            <p style="color: #999;">尚未开始</p>
                        </div>
                    </div>
                    
                    <!-- 节点2总览 -->
                    <div class="overview-node-card" data-node="2">
                        <div class="overview-node-header">
                            <h3>节点2：文献搜索</h3>
                            <span class="overview-node-status" id="overview-status-2">未开始</span>
                        </div>
                        <div class="overview-node-content" id="overview-content-2">
                            <p style="color: #999;">尚未开始</p>
                        </div>
                    </div>
                    
                    <!-- 节点3总览 -->
                    <div class="overview-node-card" data-node="3">
                        <div class="overview-node-header">
                            <h3>节点3：精选文献</h3>
                            <span class="overview-node-status" id="overview-status-3">未开始</span>
                        </div>
                        <div class="overview-node-content" id="overview-content-3">
                            <p style="color: #999;">尚未开始</p>
                        </div>
                    </div>
                    
                </div>
                
                <div id="node-content-container">
                <!-- 节点1内容: 关键词分析（自动执行，无需用户操作） -->
                <div class="node-content" id="content-node-1">
                    <div class="node-content-header">
                        <h3>关键词分析</h3>
                    </div>
                    <div class="node-content-body" id="node-body-1" style="display: block;">
                    <div id="keywords-auto-progress" style="text-align: center; padding: 40px;">
                        <div class="progress-bar" style="max-width: 400px; margin: 0 auto;">
                            <div class="progress-fill" id="keywords-progress-fill"></div>
                        </div>
                        <p id="keywords-progress-text" style="margin-top: 15px;">正在自动分析关键词...</p>
                    </div>
                    <div id="keywords-result" style="margin-top: 20px; display: none;">
                        <label>提取的关键词:</label>
                        <div id="keywords-list" style="margin-top: 10px;"></div>
                        <button class="btn btn-primary" id="regenerate-keywords-btn" style="margin-top: 15px; display: none;">重新分析</button>
                    </div>
                    </div>
                </div>

                <!-- 节点2内容: 文献搜索 -->
                <div class="node-content" id="content-node-2">
                    <div class="node-content-header">
                        <h3>文献搜索</h3>
                    </div>
                    <div class="node-content-body" id="node-body-2" style="display: block;">
                    <div id="search-params-section" class="form-group" class="d-none">
                        <!-- 搜索参数已隐藏，不再需要 -->
                    </div>
                    <button class="btn btn-primary" id="search-literature-btn" class="d-none">开始搜索文献</button>
                    <div id="search-progress" style="margin-top: 20px; display: none;">
                        <div class="progress-bar">
                            <div class="progress-fill" id="search-progress-fill"></div>
                        </div>
                        <p id="search-progress-text" style="text-align: center; margin-top: 10px;"></p>
                    </div>
                    <div id="search-results" style="margin-top: 20px; display: none;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h4 style="margin: 0;">搜索结果 (<span id="search-count">0</span> 篇)</h4>
                            <button class="btn btn-success" id="save-search-results-btn" class="d-none">保存修改</button>
                        </div>
                        <div class="literature-list" id="search-results-list" style="max-height: 1000px; overflow-y: auto; padding-right: 10px;"></div>
                        <button class="btn btn-primary" id="regenerate-node2-btn" style="margin-top: 15px; display: none;">重新搜索文献</button>
                    </div>
                    </div>
                </div>

                <!-- 节点3内容: 精选文献 -->
                <div class="node-content" id="content-node-3">
                    <div class="node-content-header">
                        <h3>精选文献</h3>
                    </div>
                    <div class="node-content-body" id="node-body-3" style="display: block;">
                    <!-- 顶部统计信息 -->
                    <div id="filter-statistics-container" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; padding: 20px; 
                                background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); 
                                border-radius: 12px; 
                                box-shadow: 0 2px 8px rgba(0,0,0,0.05);
                                border: 1px solid #e2e8f0;">
                        <div id="filter-statistics-header" style="display: flex; align-items: center; gap: 12px;">
                            <span style="font-size: 24px;">📚</span>
                            <h3 style="margin: 0; color: #1e293b; font-size: 20px; font-weight: 700;">文献列表</h3>
                        </div>
                        <div id="filter-statistics" style="display: flex; gap: 24px; font-size: 14px;">
                            <div style="display: flex; flex-direction: column; align-items: center; padding: 8px 16px; 
                                       background: white; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                                <span style="color: #64748b; font-size: 12px; margin-bottom: 4px;">总计</span>
                                <strong style="color: #3b82f6; font-size: 18px; font-weight: 700;">0</strong>
                                <span style="color: #94a3b8; font-size: 11px; margin-top: 2px;">篇</span>
                            </div>
                            <div style="display: flex; flex-direction: column; align-items: center; padding: 8px 16px; 
                                       background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); 
                                       border-radius: 8px; box-shadow: 0 1px 3px rgba(59, 130, 246, 0.2);">
                                <span style="color: #1e40af; font-size: 12px; margin-bottom: 4px; font-weight: 600;">已选用</span>
                                <strong style="color: #1e40af; font-size: 18px; font-weight: 700;">0</strong>
                                <span style="color: #3b82f6; font-size: 11px; margin-top: 2px;">篇</span>
                            </div>
                            <div style="display: flex; flex-direction: column; align-items: center; padding: 8px 16px; 
                                       background: white; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                                <span style="color: #64748b; font-size: 12px; margin-bottom: 4px;">未选用</span>
                                <strong style="color: #64748b; font-size: 18px; font-weight: 700;">0</strong>
                                <span style="color: #94a3b8; font-size: 11px; margin-top: 2px;">篇</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 操作按钮 -->
                    <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                        <button class="btn btn-warning" id="export-excel-btn">导出Excel</button>
                        <button class="btn btn-success" id="save-filter-btn" class="d-none">保存修改</button>
                    </div>
                    
                    <!-- 进度 -->
                    <div id="filter-progress" style="margin-top: 20px; display: none;">
                        <div class="progress-bar">
                            <div class="progress-fill" id="filter-progress-fill"></div>
                        </div>
                        <p id="filter-progress-text" style="text-align: center; margin-top: 10px;"></p>
                    </div>
                    
                    <!-- 文献列表 -->
                    <div id="filter-results" style="margin-top: 20px;">
                        <div class="literature-list" id="filter-results-list" style="max-height: 1000px; overflow-y: auto; padding-right: 10px;"></div>
                        <button class="btn btn-primary" id="regenerate-filter-btn" style="margin-top: 15px; display: none;">重新精选文献</button>
                    </div>
                    </div>
                </div>
                </div>
            </div>
        </div>

        <!-- Toast通知 -->
        <div class="toast" id="toast">
            <span id="toast-message"></span>
        </div>

        <!-- 文献编辑模态框 -->
        <div id="literature-edit-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; overflow-y: auto;">
            <div style="position: relative; max-width: 800px; margin: 50px auto; background: white; border-radius: 8px; padding: 30px; box-shadow: 0 4px 20px rgba(0,0,0,0.3);">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="margin: 0; color: #333;">编辑文献</h3>
                    <button id="close-edit-modal-btn" style="background: transparent; border: none; font-size: 24px; cursor: pointer; color: #999; padding: 0; width: 30px; height: 30px; line-height: 30px;">&times;</button>
                </div>
                <div id="edit-modal-content" style="max-height: 70vh; overflow-y: auto;">
                    <!-- 编辑表单内容将动态插入这里 -->
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee;">
                    <button class="btn btn-secondary" id="cancel-edit-btn">取消</button>
                    <button class="btn btn-success" id="save-edit-btn">保存</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 加载模块 -->
    <script src="js/core/electron-api.js"></script>
    <script src="js/core/api.js"></script>
    <script src="js/core/data-manager.js"></script>
    <script src="js/utils/ui-utils.js"></script>
    <script src="js/utils/dom-utils.js"></script>
    <script src="js/utils/format-utils.js"></script>
    <script src="js/nodes/node1-keywords.js"></script>
    <script src="js/nodes/node2-search.js"></script>
    <script src="js/nodes/node3-complete.js"></script>
    <script src="js/nodes/node4-filter.js"></script>
    <!-- 工作流模块（按依赖顺序加载） -->
    <script src="js/managers/subproject-manager.js"></script>
    <script src="js/workflows/workflow-state-manager.js"></script>
    <script src="js/workflows/workflow-data-loader.js"></script>
    <script src="js/workflows/literature-search-workflow.js"></script>
    <script src="js/workflows/review-writing-workflow.js"></script>
    <script src="js/workflows/workflow-manager.js"></script>
    <script src="js/pages/literature-search-workflow.js"></script>

    <!-- 进度对话框 -->
    <div id="literature-search-progress-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 10000;">
        <div style="background: white; border-radius: 12px; padding: 30px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="margin: 0; font-size: 20px; color: #1f2937;">文献查找进度</h2>
                <button id="close-progress-modal-btn" style="background: none; border: none; font-size: 24px; color: #6b7280; cursor: pointer; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; border-radius: 4px; transition: background 0.2s;"
                        onmouseover="this.style.background='#f3f4f6'"
                        onmouseout="this.style.background='none'">×</button>
            </div>
            
            <!-- 节点2：文献搜索（详细进度） -->
            <div id="progress-node-2" style="margin-bottom: 20px; padding: 20px; border: 1px solid #e5e7eb; border-radius: 8px; background: #f9fafb;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3 style="margin: 0; font-size: 18px; color: #1f2937; font-weight: 600;">节点2：文献搜索</h3>
                    <span id="progress-node-2-status" style="font-size: 14px; color: #6b7280; font-weight: 500;">等待中</span>
                </div>
                
                <!-- 总体进度条 -->
                <div style="margin-bottom: 15px;">
                    <div class="progress-bar" style="width: 100%; height: 12px; background: #e5e7eb; border-radius: 6px; overflow: hidden; box-shadow: inset 0 1px 2px rgba(0,0,0,0.1);">
                        <div id="progress-node-2-fill" class="progress-fill" style="height: 100%; background: linear-gradient(90deg, #3b82f6, #2563eb); width: 0%; transition: width 0.3s; box-shadow: 0 0 8px rgba(59, 130, 246, 0.4);"></div>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 8px;">
                        <span id="progress-node-2-percentage" style="font-size: 14px; color: #3b82f6; font-weight: 600;">0%</span>
                        <span id="progress-node-2-text" style="font-size: 14px; color: #6b7280; text-align: center;">准备开始...</span>
                    </div>
                </div>
                
                <!-- 详细信息 -->
                <div id="progress-node-2-details" style="padding: 12px; background: #ffffff; border-radius: 6px; border: 1px solid #e5e7eb;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 10px;">
                        <div>
                            <div style="font-size: 12px; color: #9ca3af; margin-bottom: 4px;">当前关键词</div>
                            <div id="progress-node-2-current-keyword" style="font-size: 14px; color: #1f2937; font-weight: 500;">-</div>
                        </div>
                        <div>
                            <div style="font-size: 12px; color: #9ca3af; margin-bottom: 4px;">关键词进度</div>
                            <div id="progress-node-2-keyword-progress" style="font-size: 14px; color: #1f2937; font-weight: 500;">-</div>
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                        <div>
                            <div style="font-size: 12px; color: #9ca3af; margin-bottom: 4px;">已搜索文献数</div>
                            <div id="progress-node-2-found-count" style="font-size: 14px; color: #1f2937; font-weight: 500;">0 篇</div>
                        </div>
                        <div>
                            <div style="font-size: 12px; color: #9ca3af; margin-bottom: 4px;">预计总文献数</div>
                            <div id="progress-node-2-total-count" style="font-size: 14px; color: #1f2937; font-weight: 500;">-</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 停止按钮 -->
            <div style="text-align: center; margin-top: 20px;">
                <button id="stop-progress-btn" style="background: #ef4444; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 500; transition: background 0.2s;"
                        onmouseover="this.style.background='#dc2626'"
                        onmouseout="this.style.background='#ef4444'">停止查找</button>
            </div>
        </div>
    </div>
</body>
</html>
